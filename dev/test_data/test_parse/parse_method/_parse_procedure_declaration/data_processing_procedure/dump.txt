ProcedureDeclaration(
  position=1:1,
  identifier='processDataStream',
  formal_parameters=[
      FormalParameter(
        position=2:9,
        identifiers=['inputStream'],
        of_type=ConformantListType(
            position=2:23,
            bound_spec=BoundSpec(
                position=2:28,
                lower=IntegerLiteral(
                    position=2:29,
                    value=1
                  ),
                upper=IndeterminateLiteral(
                    position=2:31
                  )
              ),
            unique=False,
            of=NamedType(
                position=2:37,
                reference='DataPacket'
              )
          )
      ),
      FormalParameter(
        position=3:9,
        identifiers=['processingConfig'],
        of_type=NamedType(
            position=3:28,
            reference='ProcessingConfiguration'
          )
      ),
      FormalParameter(
        position=4:13,
        identifiers=['outputStream'],
        of_type=ConformantListType(
            position=4:28,
            bound_spec=BoundSpec(
                position=4:33,
                lower=IntegerLiteral(
                    position=4:34,
                    value=1
                  ),
                upper=IndeterminateLiteral(
                    position=4:36
                  )
              ),
            unique=False,
            of=NamedType(
                position=4:42,
                reference='DataPacket'
              )
          )
      ),
      FormalParameter(
        position=5:13,
        identifiers=['processingMetrics'],
        of_type=NamedType(
            position=5:33,
            reference='ProcessingMetrics'
          )
      )
    ],
  head=AlgorithmHead(
      declarations=[
          TypeDeclaration(
            position=7:5,
            identifier='ProcessingStage',
            type_selection=EnumType(
                position=7:28,
                values=[
                    'validation',
                    'transformation',
                    'compression'
                  ]
              ),
            domain_rules=[]
          ),
          ProcedureDeclaration(
            position=11:5,
            identifier='processPacket',
            formal_parameters=[
                FormalParameter(
                  position=11:29,
                  identifiers=['packet'],
                  of_type=NamedType(
                      position=11:38,
                      reference='DataPacket'
                    )
                ),
                FormalParameter(
                  position=11:50,
                  identifiers=['stage'],
                  of_type=NamedType(
                      position=11:58,
                      reference='ProcessingStage'
                    )
                ),
                FormalParameter(
                  position=11:79,
                  identifiers=['processedPacket'],
                  of_type=NamedType(
                      position=11:97,
                      reference='DataPacket'
                    )
                )
              ],
            head=AlgorithmHead(
                declarations=[],
                constant_definitions=[],
                local_variable_definitions=[]
              ),
            body=[CaseStmt(
                position=12:9,
                selector=NameRef(
                    position=12:14,
                    identifier='stage'
                  ),
                actions=[
                    CaseAction(
                      position=13:13,
                      labels=[NameRef(
                          position=13:13,
                          identifier='validation'
                        )],
                      stmt=AssignmentStmt(
                          position=13:25,
                          target=NameRef(
                              position=13:25,
                              identifier='processedPacket'
                            ),
                          value=Call(
                              position=13:44,
                              callee=NameRef(
                                  position=13:44,
                                  identifier='validatePacket'
                                ),
                              args=[Arg(
                                  position=13:59,
                                  value=NameRef(
                                      position=13:59,
                                      identifier='packet'
                                    )
                                )]
                            )
                        )
                    ),
                    CaseAction(
                      position=14:13,
                      labels=[NameRef(
                          position=14:13,
                          identifier='transformation'
                        )],
                      stmt=AssignmentStmt(
                          position=14:29,
                          target=NameRef(
                              position=14:29,
                              identifier='processedPacket'
                            ),
                          value=Call(
                              position=14:48,
                              callee=NameRef(
                                  position=14:48,
                                  identifier='transformPacket'
                                ),
                              args=[Arg(
                                  position=14:64,
                                  value=NameRef(
                                      position=14:64,
                                      identifier='packet'
                                    )
                                )]
                            )
                        )
                    ),
                    CaseAction(
                      position=15:13,
                      labels=[NameRef(
                          position=15:13,
                          identifier='compression'
                        )],
                      stmt=AssignmentStmt(
                          position=15:26,
                          target=NameRef(
                              position=15:26,
                              identifier='processedPacket'
                            ),
                          value=Call(
                              position=15:45,
                              callee=NameRef(
                                  position=15:45,
                                  identifier='compressPacket'
                                ),
                              args=[Arg(
                                  position=15:60,
                                  value=NameRef(
                                      position=15:60,
                                      identifier='packet'
                                    )
                                )]
                            )
                        )
                    )
                  ],
                otherwise=AssignmentStmt(
                    position=16:24,
                    target=NameRef(
                        position=16:24,
                        identifier='processedPacket'
                      ),
                    value=NameRef(
                        position=16:43,
                        identifier='packet'
                      )
                  )
              )]
          )
        ],
      constant_definitions=[
          ConstantDefinition(
            position=21:9,
            identifier='maxPacketsPerBatch',
            type_selection=IntegerType(
                position=21:30
              ),
            init=IntegerLiteral(
                position=21:41,
                value=100
              )
          ),
          ConstantDefinition(
            position=22:9,
            identifier='defaultStage',
            type_selection=NamedType(
                position=22:24,
                reference='ProcessingStage'
              ),
            init=NameRef(
                position=22:43,
                identifier='validation'
              )
          )
        ],
      local_variable_definitions=[
          LocalVariableDefinition(
            position=26:9,
            identifiers=['currentPacket'],
            of_type=NamedType(
                position=26:25,
                reference='DataPacket'
              )
          ),
          LocalVariableDefinition(
            position=27:9,
            identifiers=['processedPacket'],
            of_type=NamedType(
                position=27:27,
                reference='DataPacket'
              )
          ),
          LocalVariableDefinition(
            position=28:9,
            identifiers=['processingStage'],
            of_type=NamedType(
                position=28:27,
                reference='ProcessingStage'
              )
          ),
          LocalVariableDefinition(
            position=29:9,
            identifiers=['i'],
            of_type=IntegerType(
                position=29:13
              )
          ),
          LocalVariableDefinition(
            position=30:9,
            identifiers=['batchCount'],
            of_type=IntegerType(
                position=30:22
              ),
            init=IntegerLiteral(
                position=30:33,
                value=0
              )
          )
        ]
    ),
  body=[
      AssignmentStmt(
        position=33:5,
        target=AttributeRef(
            position=33:5,
            source=NameRef(
                position=33:5,
                identifier='processingMetrics'
              ),
            identifier='totalPackets'
          ),
        value=Call(
            position=33:39,
            callee=NameRef(
                position=33:39,
                identifier='SIZEOF'
              ),
            args=[Arg(
                position=33:46,
                value=NameRef(
                    position=33:46,
                    identifier='inputStream'
                  )
              )]
          )
      ),
      AssignmentStmt(
        position=34:5,
        target=AttributeRef(
            position=34:5,
            source=NameRef(
                position=34:5,
                identifier='processingMetrics'
              ),
            identifier='processedPackets'
          ),
        value=IntegerLiteral(
            position=34:43,
            value=0
          )
      ),
      AssignmentStmt(
        position=35:5,
        target=AttributeRef(
            position=35:5,
            source=NameRef(
                position=35:5,
                identifier='processingMetrics'
              ),
            identifier='errorPackets'
          ),
        value=IntegerLiteral(
            position=35:39,
            value=0
          )
      ),
      AssignmentStmt(
        position=36:5,
        target=NameRef(
            position=36:5,
            identifier='processingStage'
          ),
        value=NameRef(
            position=36:24,
            identifier='defaultStage'
          )
      ),
      RepeatStmt(
        position=38:5,
        control=RepeatControl(
            position=38:12,
            increment_control=IncrementControl(
                position=38:12,
                variable='i',
                bound_1=IntegerLiteral(
                    position=38:17,
                    value=1
                  ),
                bound_2=Call(
                    position=38:22,
                    callee=NameRef(
                        position=38:22,
                        identifier='SIZEOF'
                      ),
                    args=[Arg(
                        position=38:29,
                        value=NameRef(
                            position=38:29,
                            identifier='inputStream'
                          )
                      )]
                  )
              )
          ),
        body=[
            AssignmentStmt(
              position=39:9,
              target=NameRef(
                  position=39:9,
                  identifier='currentPacket'
                ),
              value=IndexExpr(
                  position=39:26,
                  source=NameRef(
                      position=39:26,
                      identifier='inputStream'
                    ),
                  index=NameRef(
                      position=39:38,
                      identifier='i'
                    )
                )
            ),
            CallStmt(
              position=41:9,
              call=Call(
                  position=41:9,
                  callee=NameRef(
                      position=41:9,
                      identifier='processPacket'
                    ),
                  args=[
                      Arg(
                        position=41:23,
                        value=NameRef(
                            position=41:23,
                            identifier='currentPacket'
                          )
                      ),
                      Arg(
                        position=41:38,
                        value=NameRef(
                            position=41:38,
                            identifier='processingStage'
                          )
                      ),
                      Arg(
                        position=41:55,
                        value=NameRef(
                            position=41:55,
                            identifier='processedPacket'
                          )
                      )
                    ]
                )
            ),
            IfStmt(
              position=43:9,
              condition=AttributeRef(
                  position=43:12,
                  source=NameRef(
                      position=43:12,
                      identifier='processedPacket'
                    ),
                  identifier='isValid'
                ),
              then=[
                  CallStmt(
                    position=44:13,
                    call=Call(
                        position=44:13,
                        callee=NameRef(
                            position=44:13,
                            identifier='INSERT'
                          ),
                        args=[
                            Arg(
                              position=44:20,
                              value=NameRef(
                                  position=44:20,
                                  identifier='outputStream'
                                )
                            ),
                            Arg(
                              position=44:34,
                              value=NameRef(
                                  position=44:34,
                                  identifier='processedPacket'
                                )
                            ),
                            Arg(
                              position=44:51,
                              value=BinaryExpr(
                                  position=44:51,
                                  left=Call(
                                      position=44:51,
                                      callee=NameRef(
                                          position=44:51,
                                          identifier='SIZEOF'
                                        ),
                                      args=[Arg(
                                          position=44:58,
                                          value=NameRef(
                                              position=44:58,
                                              identifier='outputStream'
                                            )
                                        )]
                                    ),
                                  op=BinaryOp.ADD,
                                  right=IntegerLiteral(
                                      position=44:74,
                                      value=1
                                    )
                                )
                            )
                          ]
                      )
                  ),
                  AssignmentStmt(
                    position=45:13,
                    target=AttributeRef(
                        position=45:13,
                        source=NameRef(
                            position=45:13,
                            identifier='processingMetrics'
                          ),
                        identifier='processedPackets'
                      ),
                    value=BinaryExpr(
                        position=45:51,
                        left=AttributeRef(
                            position=45:51,
                            source=NameRef(
                                position=45:51,
                                identifier='processingMetrics'
                              ),
                            identifier='processedPackets'
                          ),
                        op=BinaryOp.ADD,
                        right=IntegerLiteral(
                            position=45:88,
                            value=1
                          )
                      )
                  )
                ],
              or_else=[AssignmentStmt(
                  position=47:13,
                  target=AttributeRef(
                      position=47:13,
                      source=NameRef(
                          position=47:13,
                          identifier='processingMetrics'
                        ),
                      identifier='errorPackets'
                    ),
                  value=BinaryExpr(
                      position=47:47,
                      left=AttributeRef(
                          position=47:47,
                          source=NameRef(
                              position=47:47,
                              identifier='processingMetrics'
                            ),
                          identifier='errorPackets'
                        ),
                      op=BinaryOp.ADD,
                      right=IntegerLiteral(
                          position=47:80,
                          value=1
                        )
                    )
                )]
            ),
            AssignmentStmt(
              position=50:9,
              target=NameRef(
                  position=50:9,
                  identifier='batchCount'
                ),
              value=BinaryExpr(
                  position=50:23,
                  left=NameRef(
                      position=50:23,
                      identifier='batchCount'
                    ),
                  op=BinaryOp.ADD,
                  right=IntegerLiteral(
                      position=50:36,
                      value=1
                    )
                )
            ),
            IfStmt(
              position=51:9,
              condition=BinaryExpr(
                  position=51:12,
                  left=NameRef(
                      position=51:12,
                      identifier='batchCount'
                    ),
                  op=BinaryOp.GREATER_EQUAL,
                  right=NameRef(
                      position=51:26,
                      identifier='maxPacketsPerBatch'
                    )
                ),
              then=[
                  CallStmt(
                    position=52:13,
                    call=Call(
                        position=52:13,
                        callee=NameRef(
                            position=52:13,
                            identifier='flushProcessingBuffer'
                          ),
                        args=[]
                      )
                  ),
                  AssignmentStmt(
                    position=53:13,
                    target=NameRef(
                        position=53:13,
                        identifier='batchCount'
                      ),
                    value=IntegerLiteral(
                        position=53:27,
                        value=0
                      )
                  )
                ],
              or_else=[]
            )
          ]
      ),
      AssignmentStmt(
        position=57:5,
        target=AttributeRef(
            position=57:5,
            source=NameRef(
                position=57:5,
                identifier='processingMetrics'
              ),
            identifier='successRate'
          ),
        value=BinaryExpr(
            position=57:38,
            left=AttributeRef(
                position=57:38,
                source=NameRef(
                    position=57:38,
                    identifier='processingMetrics'
                  ),
                identifier='processedPackets'
              ),
            op=BinaryOp.REAL_DIVIDE,
            right=AttributeRef(
                position=57:75,
                source=NameRef(
                    position=57:75,
                    identifier='processingMetrics'
                  ),
                identifier='totalPackets'
              )
          )
      )
    ]
)